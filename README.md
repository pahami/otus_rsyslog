# Домашняя работа 25
-------------------------------------------------

## Тема: Rsyslog: основы сбора и хранения логов 

### Цель домашнего задания

Научится проектировать централизованный сбор логов. Рассмотреть особенности разных платформ для сбора логов.

### Описание домашнего задания

  1. В Vagrant разворачиваем 2 виртуальные машины web и log

  2. на web настраиваем nginx

  3. на log настраиваем центральный лог сервер на любой системе на выбор
    - journald;
    - rsyslog;
    - elk.

  4. настраиваем аудит, следящий за изменением конфигов nginx


Все критичные логи с web должны собираться и локально и удаленно.
Все логи с nginx должны уходить на удаленный сервер (локально только критичные).
Логи аудита должны также уходить на удаленную систему.

### Формат сдачи:
Vagrantfile + ansible

### Критерии оценивания

Статус "Принято" ставится при выполнении следующих условий:
  1. Ссылка на репозиторий GitHub.
  2. Логи и скриншоты без Vagrantfile

Помимо базового задания рекомендуется сделать данное задание следующим образом:

  3. Все настройки сделать с помощью Ansible и добавить запуск Ansible playbook из Vagrantfile.

### Выполнение задания:

#### 1. Настройка рабочего стенда

Выполнение домашнего задания предполагает, что на компьютере установлен Vagrant+VirtualBox   

Развернем Vagrant-стенд:
  - Создайте папку с проектом и зайдите в нее (например: /otus_rsyslog:
```
mkdir -p otus_rsyslog ; cd ./otus_rsyslog
```
  - Клонируете проект с Github, набрав команду:
```
apt update -y && apt install git -y ; git clone https://github.com/pahami/otus_rsyslog.git
```
  - Запустите проект из папки, в которую склонировали проект (в нашем примере ./otus_rsyslog):
```
vagrant up
```
Результатом выполнения команды `vagrant up` станут 3 виртуальных машины:
 - log - сервер сбора логов rsyslog
 - web - nginx c настроенной пересылкой логов на log
 - client - вм с натроенной пересылкой логов rsysog на log

#### 2. Проверка

  HOST client:
----------------------------

```

# Создадим пользователя
sudo useradd otus
# Создадим пользователю пароль
echo -e "otus:1q2w3e4r" | sudo chpasswd
# Создаём группу test
sudo groupadd -f admin

```

  HOST web:
----------------------------

```
curl localhost:80
```

  HOST log:
----------------------------

Должны появиться логи ```sudo ls -al /var/log/rsyslog/```

<details>
<summary> Результат </summary>

```
vagrant@log:~$ sudo ls -al /var/log/rsyslog/
total 20
drwxr-xr-x 5 syslog syslog 4096 Feb 16 20:28 .
drwxrwxr-x 8 root   syslog 4096 Feb 16 20:26 ..
drwxr-xr-x 2 syslog syslog 4096 Feb 16 20:37 client
drwxr-xr-x 2 syslog syslog 4096 Feb 16 20:36 log
drwxr-xr-x 2 syslog syslog 4096 Feb 16 20:28 web

```
</details>

